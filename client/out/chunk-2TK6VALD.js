import{a as se,b as ae,c as le}from"./chunk-3SRSB7PM.js";import{b as oe}from"./chunk-TDZ4TWTQ.js";import"./chunk-PLCA6FJL.js";import"./chunk-EVRZSWWD.js";import"./chunk-4O3FVBGX.js";import{b as Q,c as g,e as K,f as Y,g as M,h as J,i as _,j as X,k as Z,l as $,o as ee,r as te,s as ie}from"./chunk-HYEO6BEG.js";import{a as H}from"./chunk-QA4SVJZK.js";import{a as re,b as ne}from"./chunk-R3E6KY3B.js";import{r as B}from"./chunk-MWUL7SM5.js";import{$ as w,Ab as v,Ba as a,Cb as S,Jb as W,Kb as j,Ma as z,Ob as q,Q as I,Qb as s,Ub as D,V as y,Vb as x,Wb as V,_ as p,ac as T,fa as G,gb as u,hb as c,ja as P,mb as h,nb as i,ob as t,pb as f,wb as O,zc as L}from"./chunk-2HKCALKT.js";import{a as N}from"./chunk-C6Q5SG76.js";var A=class r{_baseUrl=re.baseURL;_http=y(B);updateUser(o,n){return this._http.patch(this._baseUrl+`/user/update/${o}`,n)}securityDetail(o){return this._http.post(this._baseUrl+"/user/secret/set",o)}resetPassword(o){return this._http.post(this._baseUrl+"/user/password/reset",o)}static \u0275fac=function(n){return new(n||r)};static \u0275prov=I({token:r,factory:r.\u0275fac,providedIn:"root"})};function de(){return r=>{let o=r,n=o.get("secretAnswer")?.value,e=o.get("confirmSecretAnswer")?.value;return n===e?null:{passwordMismatch:!0}}}function me(){return r=>{let o=r,n=o.get("newPassword")?.value,e=o.get("confirmNewPassword")?.value;return n===e?null:{passwordMismatch:!0}}}var ce=["codeInput"],pe=()=>({width:"30rem",margin:"0 10px"}),we=()=>({width:"25rem"}),_e=()=>({standalone:!0});function fe(r,o){r&1&&s(0," name is required ")}function ve(r,o){if(r&1&&(i(0,"div",8),u(1,fe,1,0),t()),r&2){let n,e=S();a(),c((n=e.detailsForm.get("name"))!=null&&n.hasError("required")?1:-1)}}function ge(r,o){r&1&&s(0," email is required ")}function he(r,o){if(r&1&&(i(0,"div",8),u(1,ge,1,0),t()),r&2){let n,e=S();a(),c((n=e.detailsForm.get("email"))!=null&&n.hasError("required")?1:-1)}}function Se(r,o){r&1&&s(0," institution is required ")}function ye(r,o){if(r&1&&(i(0,"div",8),u(1,Se,1,0),t()),r&2){let n,e=S();a(),c((n=e.detailsForm.get("institution"))!=null&&n.hasError("required")?1:-1)}}function be(r,o){r&1&&s(0," department is required ")}function Fe(r,o){if(r&1&&(i(0,"div",8),u(1,be,1,0),t()),r&2){let n,e=S();a(),c((n=e.detailsForm.get("code"))!=null&&n.hasError("required")?1:-1)}}function Ee(r,o){r&1&&s(0," secret answer is required ")}function Ce(r,o){if(r&1&&(i(0,"div",8),u(1,Ee,1,0),t()),r&2){let n,e=S();a(),c((n=e.securityDetailsForm.get("secretAnswer"))!=null&&n.hasError("required")?1:-1)}}function Pe(r,o){r&1&&(i(0,"div",8),s(1," secrets does not match "),t())}function De(r,o){r&1&&s(0," current password is required ")}function xe(r,o){if(r&1&&(i(0,"div",8),u(1,De,1,0),t()),r&2){let n,e=S();a(),c((n=e.passwordForm.get("currentPassword"))!=null&&n.hasError("required")?1:-1)}}function Ve(r,o){r&1&&s(0," new password is required ")}function Te(r,o){if(r&1&&(i(0,"div",8),u(1,Ve,1,0),t()),r&2){let n,e=S();a(),c((n=e.passwordForm.get("newPassword"))!=null&&n.hasError("required")?1:-1)}}function Me(r,o){r&1&&(i(0,"div",8),s(1," password does not match "),t())}var k=class r{_store=y(ne);_dataService=y(A);_toast=y(H);_destroyRef=y(G);detailsForm;securityDetailsForm;passwordForm;isUpdatingDetailForm=P(!1);showProvidePasswordModal=P(!1);securityDetailPassword=P("");ngOnInit(){this.initForm(),this.setDetailsForm()}showAuthorizationDialog=!1;codeInputs=L("codeInput");requestSubmitAuthorization(){this.showAuthorizationDialog=!this.showAuthorizationDialog}moveFocus(o,n){o.target.value&&n<3?this.codeInputs()[n+1]?.nativeElement.focus():o.key==="Backspace"&&n>0&&this.codeInputs()[n-1]?.nativeElement.focus()}updateUserDetailForm(){let o=this._store.store().user?.profile.id;if(this.detailsForm.invalid){this.detailsForm.markAllAsTouched();return}let n=N({},this.detailsForm.value);this.isUpdatingDetailForm.set(!0),this._dataService.updateUser(o,n).pipe(this._toast.observe({loading:"Updating record....",success:"Record updated successfully",error:e=>e.error.message??le.DEFAULT}),oe(this._destroyRef)).subscribe({next:e=>{this.isUpdatingDetailForm.set(!1);let d={user:{profile:N({},n)}};this._store.updateStore(d),this.detailsForm.setValue({title:"",email:"",name:"",institution:"",department:"",phone_number:"",alt_phone_number:""})}})}securityDetails(){this.securityDetailsForm.invalid?(this._toast.error("Provide required field"),this.securityDetailsForm.markAllAsTouched()):this.showProvidePasswordModal.set(!0)}proceedSecurityDetail(){this.securityDetailsForm.get("password")?.setValue(this.securityDetailPassword());let o=this.securityDetailsForm.value,n={password:o.password,secret:o.secretAnswer};this._dataService.securityDetail(n).pipe(this._toast.observe({loading:"Submitting Security details...",success:"Security details submitted successfully",error:e=>e.error.message??"Sorry! Unable to perform action"})).subscribe(e=>{this.resetSecurityDetailForm(),this.showProvidePasswordModal.set(!1)})}resetPassword(){if(this.passwordForm.invalid)this.passwordForm.markAllAsTouched(),this._toast.error("Provide required field");else{let o=this.passwordForm.value,n={user_id:this._store.store().user?.profile.id,old_password:o.currentPassword,new_password:o.newPassword};this._dataService.resetPassword(n).pipe(this._toast.observe({loading:"Reseting Password...",success:"Password updated successfully",error:e=>e.error.message??"Sorry! Unable to perform action"})).subscribe(e=>{this.resetPasswordForm()})}}initForm(){this.detailsForm=new M({title:new _(""),name:new _("",g.required),email:new _("",g.required),institution:new _("",g.required),department:new _("",g.required),phone_number:new _(""),alt_phone_number:new _("")}),this.securityDetailsForm=new M({secretAnswer:new _("",g.required),confirmSecretAnswer:new _("",g.required),password:new _(""),code:new _("")},{validators:de()}),this.passwordForm=new M({currentPassword:new _("",g.required),newPassword:new _("",g.required),confirmNewPassword:new _("",g.required)},{validators:me()})}setDetailsForm(){this.detailsForm.setValue({title:this._store.store().user?.profile.title??"",email:this._store.store().user?.profile.email??"",name:this._store.store().user?.profile.first_name+" "+this._store.store().user?.profile.last_name,institution:this._store.store().user?.profile.institution??"",department:this._store.store().user?.profile.department??"",phone_number:"",alt_phone_number:""})}resetSecurityDetailForm(){this.securityDetailsForm.setValue({secretAnswer:"",confirmSecretAnswer:"",password:"",code:""})}resetPasswordForm(){this.passwordForm.setValue({currentPassword:"",newPassword:"",confirmNewPassword:""})}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=z({type:r,selectors:[["app-settings"]],viewQuery:function(n,e){n&1&&W(e.codeInputs,ce,5),n&2&&j()},decls:124,vars:28,consts:[["codeInput",""],[1,"flex","flex-col","gap-10","xl:w-5/6","2xl:w-3/6"],[1,"text-gray-800","font-bold","uppercase","tracking-wide","my-5"],[3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-3","mb-5"],[1,"form-group"],["formControlName","title","type","text","placeholder","Enter title",1,"form-control"],["formControlName","name","type","text","placeholder","Enter full name",1,"form-control"],[1,"control-error"],["formControlName","email","type","text","placeholder","Enter email",1,"form-control"],["formControlName","institution","type","text","placeholder","Enter institution",1,"form-control"],["formControlName","department","type","text","placeholder","Enter department",1,"form-control"],["formControlName","phone_number","type","text","inputmode","numeric","placeholder","Enter phone",1,"form-control"],["formControlName","alt_phone_number","type","text","inputmode","numeric","placeholder","Enter alt. phone",1,"form-control"],["type","submit",1,"btn",3,"disabled"],[1,"text-gray-800","font-bold","uppercase","tracking-wide","mt-5"],[1,"mb-5"],["formControlName","secretAnswer","type","password","placeholder","Enter secret answer",1,"form-control"],["formControlName","confirmSecretAnswer","type","password","placeholder","Enter confirm secret answer",1,"form-control"],[1,"text-xs","mb-8"],["type","button",1,"text-primary","font-semibold",3,"click"],[1,"btn"],["formControlName","currentPassword","type","password","placeholder","Enter current password",1,"form-control"],["formControlName","newPassword","type","password","placeholder","Enter password",1,"form-control"],["formControlName","confirmNewPassword","type","password","placeholder","Enter new password",1,"form-control"],["header","Verify identity",3,"visibleChange","focusOnShow","modal","visible"],[1,"text-gray-500/70","font-normal","text-xs","mb-3"],[1,"my-5","overflow-hidden"],[1,"flex","justify-center","flex-col","lg:w-5/6","m-auto"],[1,"text-base"],[1,"form-group","!flex-row","!gap-3","my-4"],["type","text","maxlength","1",1,"form-control","!size-14","text-center","!font-black","!text-lg",3,"keyup"],[1,"text-primary","font-semibold"],[1,"flex","items-center","justify-end","gap-3"],[1,"btn-outline","!rounded-xl",3,"click"],[1,"btn","!rounded-xl"],["header","SECURITY DETAILS",3,"visibleChange","modal","visible"],["type","password","placeholder","Enter password",1,"form-control",3,"ngModelChange","ngModel","ngModelOptions"],[1,"flex","justify-between","mt-4"],[1,"btn","!rounded-xl",3,"click","disabled"]],template:function(n,e){if(n&1){let d=O();i(0,"div",1)(1,"div")(2,"div",2),s(3,"user details"),t(),i(4,"form",3),v("ngSubmit",function(){return p(d),w(e.updateUserDetailForm())}),i(5,"div",4)(6,"div",5)(7,"label"),s(8,"Title"),t(),f(9,"input",6),t(),i(10,"div",5)(11,"label"),s(12,"full name"),t(),f(13,"input",7),u(14,ve,2,1,"div",8),t(),i(15,"div",5)(16,"label"),s(17,"Email"),t(),f(18,"input",9),u(19,he,2,1,"div",8),t(),i(20,"div",5)(21,"label"),s(22,"institution"),t(),f(23,"input",10),u(24,ye,2,1,"div",8),t(),i(25,"div",5)(26,"label"),s(27,"department"),t(),f(28,"input",11),u(29,Fe,2,1,"div",8),t(),i(30,"div",5)(31,"label"),s(32,"Phone number"),t(),f(33,"input",12),t(),i(34,"div",5)(35,"label"),s(36,"alternative Phone number"),t(),f(37,"input",13),t()(),i(38,"button",14),s(39,"Update changes"),t()()(),i(40,"div")(41,"div",15),s(42,"Security details"),t(),i(43,"div",16),s(44,"Set up security secret answer. this would be required for every relevant action"),t(),i(45,"form",3),v("ngSubmit",function(){return p(d),w(e.securityDetails())}),i(46,"div",4)(47,"div",5)(48,"label"),s(49,"secret answer"),t(),f(50,"input",17),u(51,Ce,2,1,"div",8),t(),i(52,"div",5)(53,"label"),s(54,"confirm secret answer"),t(),f(55,"input",18),u(56,Pe,2,0,"div",8),t()(),i(57,"div",19),s(58,"Want to reset security answer? "),i(59,"button",20),v("click",function(){return p(d),w(e.requestSubmitAuthorization())}),s(60,"Get verification code"),t()(),i(61,"button",21),s(62,"Submit"),t()()(),i(63,"div")(64,"div",15),s(65,"password settings"),t(),i(66,"div",16),s(67,"Change or set up your account password. This would be required for every relevant action"),t(),i(68,"form",3),v("ngSubmit",function(){return p(d),w(e.resetPassword())}),i(69,"div",4)(70,"div",5)(71,"label"),s(72,"Current password"),t(),f(73,"input",22),u(74,xe,2,1,"div",8),t(),i(75,"div",5)(76,"label"),s(77,"New password"),t(),f(78,"input",23),u(79,Te,2,1,"div",8),t(),i(80,"div",5)(81,"label"),s(82,"Re-type new password"),t(),f(83,"input",24),u(84,Me,2,0,"div",8),t()(),i(85,"button",21),s(86,"Change password"),t()()()(),i(87,"p-dialog",25),V("visibleChange",function(l){return p(d),x(e.showAuthorizationDialog,l)||(e.showAuthorizationDialog=l),w(l)}),i(88,"div")(89,"div",26),s(90,"Please fill in the verification code send to your email account"),t(),i(91,"div",27)(92,"div",28)(93,"div",29),s(94,"Enter verification code"),t(),i(95,"div",30)(96,"input",31,0),v("keyup",function(l){return p(d),w(e.moveFocus(l,0))}),t(),i(98,"input",31,0),v("keyup",function(l){return p(d),w(e.moveFocus(l,1))}),t(),i(100,"input",31,0),v("keyup",function(l){return p(d),w(e.moveFocus(l,2))}),t(),i(102,"input",31,0),v("keyup",function(l){return p(d),w(e.moveFocus(l,3))}),t()(),i(104,"div",19),s(105,"Didn't get code? "),i(106,"button",32),s(107,"Resent code"),t()()()(),i(108,"div",33)(109,"button",34),v("click",function(){return p(d),w(e.requestSubmitAuthorization())}),s(110,"Close"),t(),i(111,"button",35),s(112,"Submit"),t()()()(),i(113,"p-dialog",36),V("visibleChange",function(l){return p(d),x(e.showProvidePasswordModal,l)||(e.showProvidePasswordModal=l),w(l)}),i(114,"form")(115,"div",5)(116,"label"),s(117,"password"),t(),i(118,"input",37),V("ngModelChange",function(l){return p(d),x(e.securityDetailPassword,l)||(e.securityDetailPassword=l),w(l)}),t()()(),i(119,"div",38)(120,"button",34),v("click",function(){return p(d),w(e.showProvidePasswordModal.set(!e.showProvidePasswordModal()))}),s(121,"Close"),t(),i(122,"button",39),v("click",function(){return p(d),w(e.proceedSecurityDetail())}),s(123,"Proceed"),t()()()}if(n&2){let d,m,l,b,F,U,E,C,R;a(4),h("formGroup",e.detailsForm),a(10),c((d=e.detailsForm.get("name"))!=null&&d.touched&&((d=e.detailsForm.get("name"))!=null&&d.invalid)?14:-1),a(5),c((m=e.detailsForm.get("email"))!=null&&m.touched&&((m=e.detailsForm.get("email"))!=null&&m.invalid)?19:-1),a(5),c((l=e.detailsForm.get("institution"))!=null&&l.touched&&((l=e.detailsForm.get("institution"))!=null&&l.invalid)?24:-1),a(5),c((b=e.detailsForm.get("code"))!=null&&b.touched&&((b=e.detailsForm.get("code"))!=null&&b.invalid)?29:-1),a(9),h("disabled",e.detailsForm.invalid||e.isUpdatingDetailForm()),a(7),h("formGroup",e.securityDetailsForm),a(6),c((F=e.securityDetailsForm.get("secretAnswer"))!=null&&F.touched&&((F=e.securityDetailsForm.get("secretAnswer"))!=null&&F.invalid)?51:-1),a(5),c(e.securityDetailsForm.errors!=null&&e.securityDetailsForm.errors.passwordMismatch&&((U=e.securityDetailsForm.get("confirmSecretAnswer"))!=null&&U.touched)?56:-1),a(12),h("formGroup",e.passwordForm),a(6),c((E=e.passwordForm.get("currentPassword"))!=null&&E.touched&&((E=e.passwordForm.get("currentPassword"))!=null&&E.invalid)?74:-1),a(5),c((C=e.passwordForm.get("newPassword"))!=null&&C.touched&&((C=e.passwordForm.get("newPassword"))!=null&&C.invalid)?79:-1),a(5),c(e.passwordForm.errors!=null&&e.passwordForm.errors.passwordMismatch&&((R=e.passwordForm.get("confirmNewPassword"))!=null&&R.touched)?84:-1),a(3),q(T(25,pe)),h("focusOnShow",!1)("modal",!0),D("visible",e.showAuthorizationDialog),a(26),q(T(26,we)),h("modal",!0),D("visible",e.showProvidePasswordModal),a(5),D("ngModel",e.securityDetailPassword),h("ngModelOptions",T(27,_e)),a(4),h("disabled",!e.securityDetailPassword())}},dependencies:[ae,se,ie,Z,Q,K,Y,$,ee,te,X,J],encapsulation:2})};export{k as default};
