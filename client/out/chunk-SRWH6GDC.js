import{a as Z,b as $,c as ee}from"./chunk-YXGH2LZJ.js";import{b as Y}from"./chunk-ZY37CGI6.js";import"./chunk-4ATUTLVG.js";import"./chunk-DYZX3KWV.js";import"./chunk-4O3FVBGX.js";import{b as O,c as S,e as L,f as W,g as E,i as d,k as H,l as Q,o as B,s as K}from"./chunk-NDJI2DGD.js";import{a as j}from"./chunk-E6WYOAKO.js";import{a as J,b as X}from"./chunk-J7NQQLQI.js";import{r as M}from"./chunk-LKMNDKOK.js";import{$ as f,$b as P,Ba as m,Bb as b,Ib as V,Jb as q,Ma as k,Nb as A,Pb as n,Q as D,Tb as I,Ub as R,V as w,Vb as G,_ as c,fa as U,fb as _,gb as v,ja as N,lb as h,mb as t,nb as e,ob as u,vb as T,yc as z,zb as g}from"./chunk-ZXBBRZMY.js";import{a as C}from"./chunk-C6Q5SG76.js";var x=class o{_baseUrl=J.baseURL;_http=w(M);updateUser(l,r){return this._http.patch(this._baseUrl+`/user/update/${l}`,r)}static \u0275fac=function(r){return new(r||o)};static \u0275prov=D({token:o,factory:o.\u0275fac,providedIn:"root"})};var ie=["codeInput"],ne=()=>({width:"30rem",margin:"0 10px"});function re(o,l){o&1&&n(0," name is required ")}function oe(o,l){if(o&1&&(t(0,"div",8),_(1,re,1,0),e()),o&2){let r,i=b();m(),v((r=i.detailsForm.get("name"))!=null&&r.hasError("required")?1:-1)}}function le(o,l){o&1&&n(0," email is required ")}function ae(o,l){if(o&1&&(t(0,"div",8),_(1,le,1,0),e()),o&2){let r,i=b();m(),v((r=i.detailsForm.get("email"))!=null&&r.hasError("required")?1:-1)}}function se(o,l){o&1&&n(0," institution is required ")}function me(o,l){if(o&1&&(t(0,"div",8),_(1,se,1,0),e()),o&2){let r,i=b();m(),v((r=i.detailsForm.get("institution"))!=null&&r.hasError("required")?1:-1)}}function de(o,l){o&1&&n(0," department is required ")}function ue(o,l){if(o&1&&(t(0,"div",8),_(1,de,1,0),e()),o&2){let r,i=b();m(),v((r=i.detailsForm.get("code"))!=null&&r.hasError("required")?1:-1)}}var F=class o{_store=w(X);_dataService=w(x);_toast=w(j);_destroyRef=w(U);detailsForm;securityDetailsForm;passwordForm;isUpdatingDetailForm=N(!1);ngOnInit(){this.initForm(),this.detailsForm.setValue({title:this._store.store().user?.profile.title??"",email:this._store.store().user?.profile.email??"",name:this._store.store().user?.profile.first_name+" "+this._store.store().user?.profile.last_name,institution:this._store.store().user?.profile.institution??"",department:this._store.store().user?.profile.department??"",phone_number:"",alt_phone_number:""})}showAuthorizationDialog=!1;codeInputs=z("codeInput");requestSubmitAuthorization(){this.showAuthorizationDialog=!this.showAuthorizationDialog}moveFocus(l,r){l.target.value&&r<3?this.codeInputs()[r+1]?.nativeElement.focus():l.key==="Backspace"&&r>0&&this.codeInputs()[r-1]?.nativeElement.focus()}updateUserDetailForm(){let l=this._store.store().user?.profile.id;if(this.detailsForm.invalid){this.detailsForm.markAllAsTouched();return}let r=C({},this.detailsForm.value);this.isUpdatingDetailForm.set(!0),this._dataService.updateUser(l,r).pipe(this._toast.observe({loading:"Updating record....",success:"Record updated successfully",error:i=>i.error.message??ee.DEFAULT}),Y(this._destroyRef)).subscribe({next:i=>{this.isUpdatingDetailForm.set(!1);let a={user:{profile:C({},r)}};this._store.updateStore(a),this.detailsForm.setValue({title:"",email:"",name:"",institution:"",department:"",phone_number:"",alt_phone_number:""})}})}initForm(){this.detailsForm=new E({title:new d(""),name:new d("",S.required),email:new d("",S.required),institution:new d("",S.required),department:new d("",S.required),phone_number:new d(""),alt_phone_number:new d("")}),this.securityDetailsForm=new E({secretAnswer:new d(""),confirmSecretAnswer:new d(""),code:new d("")}),this.passwordForm=new E({currentPassword:new d(""),newPassword:new d(""),confirmNewPassword:new d("")})}static \u0275fac=function(r){return new(r||o)};static \u0275cmp=k({type:o,selectors:[["app-settings"]],viewQuery:function(r,i){r&1&&V(i.codeInputs,ie,5),r&2&&q()},decls:108,vars:14,consts:[["codeInput",""],[1,"flex","flex-col","gap-10","xl:w-5/6","2xl:w-3/6"],[1,"text-gray-800","font-bold","uppercase","tracking-wide","my-5"],[3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-3","mb-5"],[1,"form-group"],["formControlName","title","type","text","placeholder","Enter title",1,"form-control"],["formControlName","name","type","text","placeholder","Enter full name",1,"form-control"],[1,"control-error"],["formControlName","email","type","text","placeholder","Enter email",1,"form-control"],["formControlName","institution","type","text","placeholder","Enter institution",1,"form-control"],["formControlName","department","type","text","placeholder","Enter department",1,"form-control"],["formControlName","phone_number","type","text","inputmode","numeric","placeholder","Enter phone",1,"form-control"],["formControlName","alt_phone_number","type","text","inputmode","numeric","placeholder","Enter alt. phone",1,"form-control"],["type","submit",1,"btn",3,"disabled"],[1,"text-gray-800","font-bold","uppercase","tracking-wide","mt-5"],[1,"mb-5"],[3,"formGroup"],["formControlName","secretAnswer","type","password","placeholder","Enter secret answer",1,"form-control"],["formControlName","confirmSecretAnswer","type","password","placeholder","Enter confirm secret anser",1,"form-control"],[1,"text-xs","mb-8"],["type","button",1,"text-primary","font-semibold",3,"click"],[1,"btn"],["formControlName","currentPassword","type","password","placeholder","Enter current password",1,"form-control"],["formControlName","newPassword","type","password","placeholder","Enter password",1,"form-control"],["formControlName","confirmNewPassword","type","password","placeholder","Enter new password",1,"form-control"],["header","Verify identity",3,"visibleChange","focusOnShow","modal","visible"],[1,"text-gray-500/70","font-normal","text-xs","mb-3"],[1,"my-5","overflow-hidden"],[1,"flex","justify-center","flex-col","lg:w-5/6","m-auto"],[1,"text-base"],[1,"form-group","!flex-row","!gap-3","my-4"],["type","text","maxlength","1",1,"form-control","!size-14","text-center","!font-black","!text-lg",3,"keyup"],[1,"text-primary","font-semibold"],[1,"flex","items-center","justify-end","gap-3"],[1,"btn-outline","!rounded-xl",3,"click"],[1,"btn","!rounded-xl"]],template:function(r,i){if(r&1){let a=T();t(0,"div",1)(1,"div")(2,"div",2),n(3,"user details"),e(),t(4,"form",3),g("ngSubmit",function(){return c(a),f(i.updateUserDetailForm())}),t(5,"div",4)(6,"div",5)(7,"label"),n(8,"Title"),e(),u(9,"input",6),e(),t(10,"div",5)(11,"label"),n(12,"full name"),e(),u(13,"input",7),_(14,oe,2,1,"div",8),e(),t(15,"div",5)(16,"label"),n(17,"Email"),e(),u(18,"input",9),_(19,ae,2,1,"div",8),e(),t(20,"div",5)(21,"label"),n(22,"institution"),e(),u(23,"input",10),_(24,me,2,1,"div",8),e(),t(25,"div",5)(26,"label"),n(27,"department"),e(),u(28,"input",11),_(29,ue,2,1,"div",8),e(),t(30,"div",5)(31,"label"),n(32,"Phone number"),e(),u(33,"input",12),e(),t(34,"div",5)(35,"label"),n(36,"alternative Phone number"),e(),u(37,"input",13),e()(),t(38,"button",14),n(39,"Update changes"),e()()(),t(40,"div")(41,"div",15),n(42,"Security details"),e(),t(43,"div",16),n(44,"Set up security secret answer. this would be required for every relevant action"),e(),t(45,"form",17)(46,"div",4)(47,"div",5)(48,"label"),n(49,"secret answer"),e(),u(50,"input",18),e(),t(51,"div",5)(52,"label"),n(53,"confirm secret answer"),e(),u(54,"input",19),e()(),t(55,"div",20),n(56,"Want to reset security answer? "),t(57,"button",21),g("click",function(){return c(a),f(i.requestSubmitAuthorization())}),n(58,"Get verification code"),e()(),t(59,"button",22),n(60,"Submit"),e()()(),t(61,"div")(62,"div",15),n(63,"password settings"),e(),t(64,"div",16),n(65,"Change or set up your account password. This would be required for every relevant action"),e(),t(66,"form",17)(67,"div",4)(68,"div",5)(69,"label"),n(70,"Current password"),e(),u(71,"input",23),e(),t(72,"div",5)(73,"label"),n(74,"New password"),e(),u(75,"input",24),e(),t(76,"div",5)(77,"label"),n(78,"Re-type new password"),e(),u(79,"input",25),e()(),t(80,"button",22),n(81,"Change password"),e()()()(),t(82,"p-dialog",26),G("visibleChange",function(s){return c(a),R(i.showAuthorizationDialog,s)||(i.showAuthorizationDialog=s),f(s)}),t(83,"div")(84,"div",27),n(85,"Please fill in the verification code send to your email account"),e(),t(86,"div",28)(87,"div",29)(88,"div",30),n(89,"Enter verification code"),e(),t(90,"div",31)(91,"input",32,0),g("keyup",function(s){return c(a),f(i.moveFocus(s,0))}),e(),t(93,"input",32,0),g("keyup",function(s){return c(a),f(i.moveFocus(s,1))}),e(),t(95,"input",32,0),g("keyup",function(s){return c(a),f(i.moveFocus(s,2))}),e(),t(97,"input",32,0),g("keyup",function(s){return c(a),f(i.moveFocus(s,3))}),e()(),t(99,"div",20),n(100,"Didn't get code? "),t(101,"button",33),n(102,"Resent code"),e()()()(),t(103,"div",34)(104,"button",35),g("click",function(){return c(a),f(i.requestSubmitAuthorization())}),n(105,"Close"),e(),t(106,"button",36),n(107,"Submit"),e()()()()}if(r&2){let a,p,s,y;m(4),h("formGroup",i.detailsForm),m(10),v((a=i.detailsForm.get("name"))!=null&&a.touched&&((a=i.detailsForm.get("name"))!=null&&a.invalid)?14:-1),m(5),v((p=i.detailsForm.get("email"))!=null&&p.touched&&((p=i.detailsForm.get("email"))!=null&&p.invalid)?19:-1),m(5),v((s=i.detailsForm.get("institution"))!=null&&s.touched&&((s=i.detailsForm.get("institution"))!=null&&s.invalid)?24:-1),m(5),v((y=i.detailsForm.get("code"))!=null&&y.touched&&((y=i.detailsForm.get("code"))!=null&&y.invalid)?29:-1),m(9),h("disabled",i.detailsForm.invalid||i.isUpdatingDetailForm()),m(7),h("formGroup",i.securityDetailsForm),m(21),h("formGroup",i.passwordForm),m(16),A(P(13,ne)),h("focusOnShow",!1)("modal",!0),I("visible",i.showAuthorizationDialog)}},dependencies:[$,Z,K,H,O,L,W,Q,B],encapsulation:2})};export{F as default};
